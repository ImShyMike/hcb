<% content_for :head do %>
  	<script src="https://js.stripe.com/v3/"></script>
  	<script defer>
	  	$(document).on('turbolinks:load', function() {
	  		const stripe = Stripe('<%= StripeService.publishable_key %>')
	  		const elements = stripe.elements()
	  		const clientSecret = '<%= @donation.stripe_client_secret %>'

	  		var style = {
			  base: {
			    color: "gray",
			  }
			};

			var card = elements.create("card", { style: style });
			card.mount("#card-element");

			card.addEventListener('change', function(event) {
			  var displayError = document.getElementById('card-errors');
			  if (event.error) {
			    displayError.textContent = event.error.message;
			  } else {
			    displayError.textContent = '';
			  }
			});

			var submitButton = document.getElementById('submit');

			submitButton.addEventListener('click', function(ev) {
			  stripe.confirmCardPayment(clientSecret, {
			    payment_method: {card: card}
			  }).then(function(result) {
			    if (result.error) {
			      // Show error to your customer (e.g., insufficient funds)
			      console.log(result.error.message);
			    } else {
			      // The payment has been processed!
			      if (result.paymentIntent.status === 'succeeded') {
			        $('#card-element').hide()
			        $('#success').show()
			      }
			    }
			  });
			});
		})
  	</script>
<% end %>

<% title 'Donate to ' + @event.name %>
<% page_md %>

<h1>Donate to <%= @event.name %></h1>
<div class="stripe">
	<div id="card-element" style="width: 24rem;
	    border: 1px gray solid;
	    border-radius: 5px;
	    padding: 1rem;
	">
	  <!-- Elements will create input elements here -->
	</div>
	<div id="card-errors" role="alert"></div>

	<button id="submit">Pay</button>
</div>

<div id="success" style="display: none">
	<p>Success! Your payment went through.</p>
</div>

<!-- We'll put the error messages in this element -->

