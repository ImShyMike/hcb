<% title "Donation for #{render_money @donation.amount}" %>
<% page_md %>
<% include_modals %>
<%= render 'events/nav' %>

<% admin_tools('mt3') do %>
  <%= link_to 'View on Stripe', @donation.stripe_dashboard_url, class: 'btn bg-accent' %>
<% end %>

<% admin_tools do %>
  <%= link_to "#{render_money @donation.payout.t_transaction.amount} payout TX", @donation.payout.t_transaction if @donation.payout.t_transaction %>
  <%= link_to "#{render_money @donation.fee_reimbursement.t_transaction.amount} fee refund TX", @donation.fee_reimbursement.t_transaction if @donation.fee_reimbursement.t_transaction %>
<% end %>

<article class="card pb0 mt3 mb3">
  <h2 class="h2 mt0 border-none">
    <%= @donation.name %>
    <span class="regular muted"> donated </span>
    <span class="regular"><%= render_money @donation.amount_received %></span>
  </h2>
  <section class="card__banner card__darker details-horiz border-top border-bottom">
    <% if @donation&.payout&.type == 'card' %>
      <action data-behavior="modal_trigger" data-modal="payment_details" class="details-horiz__col pointer" tabindex="0">
        <strong>
          <%# Nested tag to avoid flexbox-induced full-width strong leading to icon on right edge on mobile %>
          <span class="inline-flex items-start relative" style="padding-right: 28px;">
            Payment method
            <%= inline_icon 'external', size: 24, class: 'muted ml1 absolute right-0', 'aria-label': 'Icon indicating click for more' %>
          </span>
        </strong>
        <span class="inline-flex">
          <%# donation_payment_method_mention %>
        </span>
      </action>
    <% else %>
      <p>
        <strong>Payment method</strong>
        <span class="inline-flex">
          <%# donation_payment_method_mention %>
        </span>
      </p>
    <% end %>
    <p>
      <strong>Paid at</strong>
      <%= donation_paid_at %>
    </p>
    <%= donation_payout_datetime %>
  </section>
  <% if @donation.payout %>
    <section class="pt2 pb2 details">
      <p>
        <strong>Donor email</strong>
        <% if organizer_signed_in? %>
          <%= mail_to @donation.email, @donation.email.downcase, class: 'slate underline' %>
        <% else %>
          <strong>Sign in to view</strong>
        <% end %>
      </p>
      <p>
        <strong>Amount</strong>
        +<%= render_money @donation.amount %>
      </p>
      <p>
        <strong><%# invoice_fee_type %></strong>
        -<%= donation_payment_processor_fee %>
      </p>
      <p>
        <strong>Processing fee refund</strong>
        <span>
          +<%= donation_payment_processor_fee%>
          <span class="muted">
            <% 'Pending ' unless @donation&.fee_reimbursement&.t_transaction %>
            (<%= link_to 'learn more', "https://changelog.bank.hackclub.com/we're-making-payment-processing-fees-disappear-101088" %>)
          </span>
        </span>
      </p>
    </section>
  <% end %>
</article>

<%= render 'comments/comments' %>
