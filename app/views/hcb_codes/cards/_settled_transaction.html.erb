<h1 class="heading h1 mt0 mb0">
  <span class="flex-auto">
    <%= ct.fee_payment? ? "Fee payment" : "Transaction" %>
  </span>
  <span class="h2 regular">
    <%= number_to_currency ct.amount %>
  </span>
</h1>

<div class="flex items-center mb2">
  <p class="flex-auto mr1 mb0">
    <strong class="block">Memo</strong>
    <span>
      <%= ct.display_name %>
    </span>
  </p>

  <%= pop_icon_to "edit",
    edit_canonical_transaction_path(ct),
    disabled: !organizer_signed_in?,
    class: "right tooltipped tooltipped--w", "aria-label": "Rename transaction" %>
</div>

<section class="details">
  <p>
    <strong>Date</strong>
    <%= format_date ct.date.to_date %>
  </p>

  <% if ct.invoice_payout&.invoice %>
    <p>
      <strong>For</strong>
      <%= link_to "Invoice of #{render_money ct.invoice_payout.invoice.item_amount}", invoice_path(ct.invoice_payout.invoice) %>
    </p>
  <% end %>

  <% if ct.fee_reimbursement&.invoice %>
  <p>
    <strong>For</strong>
    <span>
    <%= link_to "Refunding fees from an invoice of #{render_money ct.fee_reimbursement.invoice.item_amount}", ct.fee_reimbursement.invoice %>
    </span>
  </p>
  <% end %>

  <% if ct&.disbursement %>
  <p>
    <strong>For</strong>
    <span>
    <%= link_to "A disbursement of #{render_money ct.disbursement.amount}", ct.disbursement %>
    </span>
  </p>
  <% end %>

  <% if ct&.check %>
  <p>
    <strong>For</strong>
    <span>
    <%= link_to "A check of #{render_money ct.check.amount}", ct.check %>
    </span>
  </p>
  <% end %>

  <% if ct&.ach_transfer %>
  <p>
    <strong>For</strong>
    <span>
    <%= link_to "A transfer of #{render_money ct.ach_transfer.amount}", ct.ach_transfer %>
    </span>
  </p>
  <% end %>

  <% if ct&.donation_payout %>
  <p>
    <strong>For</strong>
    <span>
     <%= link_to "A donation of #{render_money ct.donation_payout.donation.amount} from #{ct.donation_payout.donation.name}", ct.donation_payout.donation %>
    </span>
  </p>
  <% end %>

  <% if ct.fee_reimbursement&.donation %>
  <p>
    <strong>For</strong>
    <span>
    <%= link_to "Refunding fees from a donation of #{render_money ct.fee_reimbursement.donation.amount}", ct.fee_reimbursement.donation %>
    </span>
  </p>
  <% end %>

  <% if ct.fee_applies? %>
    <% ct.fees.each do |fee| %>
      <p>
        <strong>Fee</strong>
        <%= render_money fee.amount_cents_as_decimal %> (<%= render_percentage fee.event_sponsorship_fee %>)


        <% admin_tools('py0') do %>
          <%= link_to "[waive fee]", waive_fee_canonical_transaction_url(ct), method: :post if fee.amount_cents_as_decimal > 0 %>
        <% end %>
      </p>
    <% end %>
  <% elsif ct.fee_payment? %>
    <p>
      <strong>Note</strong>
      <strong>This is a fee payment</strong>
    </p>
  <% else %>
    <% ct.fees.each do |fee| %>
      <% admin_tools('py0') do %>
        <%= link_to "[unwaive fee]", unwaive_fee_canonical_transaction_url(ct), method: :post if fee.revenue_waived? %>
      <% end %>
    <% end %>
  <% end %>

  <% if ct.emburse_transfer %>
    <p>
      <strong>Transfer Request</strong>
      <%= link_to 'View', emburse_transfer_path(ct.emburse_transfer) %>
    </p>
  <% end %>

</section>
