<% @disabled = local_assigns[:hcb_code].amount_cents >= -100 %>
<% if policy(local_assigns[:hcb_code]).invoice_as_personal_transaction? && local_assigns[:hcb_code].personal_transaction.nil? %>
  <div class="flex muted justify-end items-end">
    <%= inline_icon "sad", size: 20 %>
    <% if !@disabled %>
       <%= link_to invoice_as_personal_transaction_hcb_code_path(id: local_assigns[:hcb_code].hashid), method: :post, data: { confirm: "Are you sure you'd like to invoice #{hcb_code.stripe_cardholder&.user&.name || "yourself"} for this transaction? They'll be emailed an invoice." } do %>
         <small class="mt0 mb0 tooltipped tooltipped--s" aria-label="<%= "Invoice #{hcb_code.stripe_cardholder&.user&.name || "yourself"} for this transaction." %>">
           Flag as accidental misuse
         </small>
       <% end %>
    <% else %>
      <small class="mt0 mb0 tooltipped tooltipped--s" aria-label="Invoices can only be generated for charges of $1.00 or more.">
         Flag as accidental misuse
       </small>
    <% end %>
  </div>
<% end %>
