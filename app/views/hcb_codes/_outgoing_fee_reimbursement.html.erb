<div class="mt4 mb3">
  <article class="card pb0 mb1">

    <h2 class="h2 mt0 mx0 border-none flex items-center justify-between" style="gap: 8px">
      <div class="flex-auto" style="flex-grow: 1">
        <%= turbo_frame_tag @hcb_code do %>
          <%= pop_icon_to "edit",
              edit_hcb_code_path(@hcb_code),
              class: "mr2 align-middle", "aria-label": "Rename transaction",
              data: { turbo: true } %>

          <span class="align-middle"
                data-controller="navigation"
                data-action="dblclick->navigation#navigate"
                data-navigation-location-param="<%= edit_hcb_code_path(@hcb_code) %>"
                data-navigation-frame-param="<%= dom_id(@hcb_code) %>">
            <%= @hcb_code.memo %>
            <span class="regular muted"> for </span>
            <%= number_to_currency(@hcb_code.amount) %>
          </span>
        <% end %>
      </div>
      <%= render partial: "hcb_codes/meatballs", locals: { hcb_code: @hcb_code } %>
    </h2>

    <section class="card__banner card__darker details-horiz border-top border-bottom">
      <p>
        <strong>Date</strong>
        <%= format_date @hcb_code.date %>
      </p>
      <p>
        <strong>Type</strong>
        Outgoing fee reimbursement
      </p>
    </section>
    <table class="mt1">
      <tbody>
        <% FeeReimbursement
             .where("processed_at > ? AND processed_at < ?", @hcb_code.ct.date.beginning_of_week - 7.days, @hcb_code.ct.date.end_of_week + 7.days)
             .select { |fr| fr.hcb_code == @hcb_code.hcb_code }.reverse.each do |fr| %>
          <tr>
            <td style="padding-left: 0rem" class="medium">
              <%= fr.canonical_transaction.date.strftime("%Y-%m-%d") %>
            </td>
            <td style="white-space: normal;">
              <%= link_to (fr.invoice || fr.donation)&.local_hcb_code&.memo || "Unknown", fr.invoice || fr.donation || fr.transaction %>
              (reimbursed to <%= fr.event.name %>)
            </td>
            <td><%= render_money fr.amount %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <section class='details pt2 pb2'>
      <%= render "hcb_codes/tags", hcb_code: @hcb_code, event: (@event || @hcb_code.event) %>
    </section>
  </article>
</div>
