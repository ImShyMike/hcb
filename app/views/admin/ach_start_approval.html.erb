<h1>Process ACH Transfer #<%= @ach_transfer.id %></h1>
<p><small>Current Status: <%= @ach_transfer.aasm_state %></small></p>

</hr>

<h3>Instructions</h3>

<p>Go to <%= link_to "this ACH transfer", @ach_transfer %>.</p>

<p>Steps to process ACH:</p>

<ol>
  <li><b>Check that all values below look correct.</b></li>
  <li class="bold">Check the notes area for any messages from Bank staff before processing.</li>
  <li>Go into SVB &rarr; "Bill Pay" and create a new individual payee with the information below, and be sure to include the nickname.</li>
  <li>Under Bill Pay, initiate a new ACH transfer to the new payee, out from the "Fiscal Sponsorship New - 2" account if there is one.</li>
  <li>Make sure the transaction is also <b>approved</b> in Bill Pay, so it can successfully go through.</li>
  <li>Click "Mark as approved and sent" below to finish</li>
  <li>Make sure that we have proper documentation and papertrail for this ACH transfer! You can <%= link_to "attach receipts or other notes to the ACH transfer", @ach_transfer %> to keep track.</li>
</ol>

<p>
  Submitted by:
  <%= "ADMIN" if @ach_transfer.creator.admin? %> <%= @ach_transfer.creator.name %>
  (<%= link_to @ach_transfer.creator.phone_number, "tel:#{@ach_transfer.creator.phone_number}" %>, <%= mail_to @ach_transfer.creator.email %>) of <%= link_to @ach_transfer.event.name, @ach_transfer.event %>
</p>

<p>
  <%= avatar_for @ach_transfer.creator %>
</p>

<hr/>

<h3>ACH Details</h3>

<table class="table--autosize">
  <tbody>
    <tr>
      <td style="text-align: right;">Payee Name:</td>
      <td><%= @ach_transfer.recipient_name %></td>
      <td>
        <span class="m0 badge pointer" onClick="navigator.clipboard.writeText('<%= @ach_transfer.recipient_name %>');">
          copy
        </span>
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">Payee Phone Number:</td>
      <td><%= @ach_transfer.recipient_tel %></td>
      <td>
        <span class="m0 badge pointer" onClick="navigator.clipboard.writeText('<%= @ach_transfer.recipient_tel %>');">
          copy
        </span>
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">Payee Nickname:</td>
      <td>HCB ACH #<%= @ach_transfer.id %></td>
      <td>
        <span class="m0 badge pointer" onClick="navigator.clipboard.writeText('HCB ACH #<%= @ach_transfer.id %>');">
          copy
        </span>
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">Payment for:</td>
      <td><%= @ach_transfer.payment_for %></td>
    </tr>
    <tr>
      <td style="text-align: right;">Bank Name:</td>
      <td><%= @ach_transfer.bank_name %></td>
    </tr>
    <tr>
      <td style="text-align: right;">Account Number:</td>
      <td><%= @ach_transfer.account_number %></td>
      <td>
        <span class="m0 badge pointer" onClick="navigator.clipboard.writeText('<%= @ach_transfer.account_number %>');">
          copy
        </span>
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">Routing Number:</td>
      <td><%= @ach_transfer.routing_number %></td>
      <td>
        <span class="m0 badge pointer" onClick="navigator.clipboard.writeText('<%= @ach_transfer.routing_number %>');">
          copy
        </span>
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">Amount</td>
      <td><%= render_money_amount @ach_transfer.amount %></td>
      <td>
        <span class="m0 badge pointer" onClick="navigator.clipboard.writeText('<%= render_money_amount @ach_transfer.amount %>');">
          copy
        </span>
      </td>
    </tr>
  </tbody>
</table>

<hr/>

<h3>Actions</h3>


<% if @ach_transfer.pending? %>
  <%= form_with(model: nil, local: true, url: ach_approve_admin_path(@ach_transfer), method: :post) do |form| %>
    <%= form.label :scheduled_arrival_date, "Estimated arrival date:" %>
    <br/>
    <%= form.text_field :scheduled_arrival_date, required: true, placeholder: "MM/DD/YYYY", pattern: '\d{1,2}/\d{1,2}/\d{4}' %>

    <br/>
    <%= form.label :confirmation_number, "Confirmation number:" %>
    <br/>
    <%= form.text_field :confirmation_number, required: true %>

    <p><%= form.submit "Mark as approved and sent", data: {confirm: "Mark as approved and sent?"} %></p>
  <% end %>

  <p>or</p>

  <%= form_with(model: nil, local: true, url: ach_reject_admin_path(@ach_transfer), method: :post) do |form| %>
    <%= form.submit "Reject", data: {confirm: "Mark as rejected? This requires you to communicate to the organizer about the reason why."} %>
    <small>(This requires you to communicate to the organizer about the reason why.)</small>
  <% end %>
<% else %>
  <p><strong>ACH Transfer already processed â€” cannot approve nor reject.</strong></p>
  <p>Estimated Arrival Date: <%= @ach_transfer.scheduled_arrival_date %></p>
  <p>Confirmation Number: <%= @ach_transfer.confirmation_number || "NONE" %></p>
<% end %>
