<h1>Process ACH Transfer #<%= @ach_transfer.id %></h1>
<p><small>Current Status: <%= @ach_transfer.aasm_state %></small></p>

</hr>

<h3>Instructions</h3>

<p>Go to <%= link_to "this ACH transfer", @ach_transfer %>.</p>

<p>Steps to process ACH:</p>

<ol>
  <li><b>Check that all values below look correct.</b></li>
  <li class="bold">Check the notes area for any messages from Bank staff before processing.</li>
  <li>Go into SVB &gt; "Bill Pay" and create a new individual payee with the information below, and be sure to include the nickname.</li>
  <li>Under Bill Pay, initiate a new ACH transfer to the new payee, out from the "Fiscal Sponsorship New -2" account if there is one.</li>
  <li>Make sure the transaction is also <b>approved</b> in Bill Pay, so it can successfully go through.</li>
  <li>Click "Mark as approved and sent" below to finish</li>
  <li>Make sure that we have proper documentation and papertrail for this ACH transfer! You can <%= link_to "attach receipts or other notes to the ACH transfer", @ach_transfer %> to keep track.</li>
</ol>

<p>
  Submitted by:
  <%= "ADMIN" if @ach_transfer.creator.admin? %> <%= @ach_transfer.creator.initial_name %>
  (<%= link_to @ach_transfer.creator.pretty_phone_number, "tel:#{@ach_transfer.creator.phone_number}" %>, <%= mail_to @ach_transfer.creator.email %>) of <%= link_to @ach_transfer.event.name, @ach_transfer.event %>
</p>

<p>
  <%= avatar_for @ach_transfer.creator %>
</p>

<hr/>

<h3>ACH Details</h3>

<table>
  <tbody>
    <tr>
      <td style="text-align: right;">Payee Name:</td>
      <td><%= @ach_transfer.recipient_name %></td>
    </tr>
    <tr>
      <td style="text-align: right;">Payee Nickname:</td>
      <td>HCB ACH #<%= @ach_transfer.id %></td>
    </tr>
    <tr>
      <td style="text-align: right;">Payee Phone Number:</td>
      <td><%= @ach_transfer.recipient_tel %></td>
    </tr>
    <tr>
      <td style="text-align: right;">Payment for:</td>
      <td><%= @ach_transfer.payment_for %></td>
    </tr>
    <tr>
      <td style="text-align: right;">Bank Name:</td>
      <td><%= @ach_transfer.bank_name %></td>
    </tr>
    <tr>
      <td style="text-align: right;">Account Number:</td>
      <td><%= @ach_transfer.account_number %></td>
    </tr>
    <tr>
      <td style="text-align: right;">Routing Number:</td>
      <td><%= @ach_transfer.routing_number %></td>
    </tr>
    <tr>
      <td style="text-align: right;">Amount</td>
      <td><%= @ach_transfer.amount/100.00 %></td>
    </tr>
  </tbody>
</table>

<hr/>

<h3>Actions</h3>


<% if @ach_transfer.pending? %>
  <%= form_with(model: nil, local: true, url: ach_approve_admin_path(@ach_transfer), method: :post) do |form| %>
    <%= form.label :scheduled_arrival_date, "Estimated arrival date:" %>
    <br/>
    <%= form.text_field :scheduled_arrival_date, required: true, placeholder: "YYYY-MM-DD", pattern: '\d{4}-\d{2}-\d{2}' %>
    <p><%= form.submit "Mark as approved and sent", data: {confirm: "Mark as approved and sent?"} %></p>
  <% end %>

  <p>or</p>

  <%= form_with(model: nil, local: true, url: ach_reject_admin_path(@ach_transfer), method: :post) do |form| %>
    <%= form.submit "Reject", data: {confirm: "Mark as rejected? This requires you to communicate to the organizer about the reason why."} %>
    <small>(This requires you to communicate to the organizer about the reason why.)</small>
  <% end %>
<% else %>
  <p><strong>ACH Transfer already processed -- cannot approve nor reject.</strong></p>
<% end %>
