<% hcb_code = activity.trackable.local_hcb_code %>

<% if hcb_code && !activity.trackable.declined? %>

  <%# donation %>
  <% if hcb_code.donation? && hcb_code.donation.present? %>
    <%= render layout: "/public_activity/common", locals: { activity:, hide_owner: true, icon: "support", color: "purple" } do %>
      <%= hcb_code.donation.name(show_anonymous: organizer_signed_in?) %>
      donated <%= render_money hcb_code.amount %> to <%= link_to activity.trackable.event.name, activity.trackable.event %>
    <% end %>
  <% end %>

  <%# invoice %>
  <% if hcb_code.invoice? && hcb_code.invoice.present? %>
    <%= render layout: "/public_activity/common", locals: { activity:, hide_owner: true, icon: "briefcase", color: "info" } do %>
      <%= hcb_code.invoice.sponsor.name %> paid a <%= render_money hcb_code.amount %>
      invoice on <%= link_to activity.trackable.event.name, activity.trackable.event %>
    <% end %>
  <% end %>

  <%# ach_transfer %>
  <% if hcb_code.ach_transfer? && hcb_code.ach_transfer.present? %>
    <%= render layout: "/public_activity/common", locals: { activity:, hide_owner: true, icon: "payment-transfer", color: "info" } do %>
      <%= hcb_code.ach_transfer.creator.name %> sent <%= render_money hcb_code.amount %>
      to <%= hcb_code.ach_transfer.recipient_name %> from <%= link_to activity.trackable.event.name, activity.trackable.event %>
    <% end %>
  <% end %>

  <%# check %>
  <% if hcb_code.increase_check? && hcb_code.increase_check.present? %>
    <%= render layout: "/public_activity/common", locals: { activity:, hide_owner: true, icon: "email", color: "info" } do %>
      <%= hcb_code.increase_check.user.name %> sent <%= render_money hcb_code.amount %>
      to <%= hcb_code.increase_check.recipient_name %> from <%= link_to activity.trackable.event.name, activity.trackable.event %>
    <% end %>
  <% end %>

  <%# check deposit %>
  <% if hcb_code.check_deposit? && hcb_code.check_deposit.present? %>
    <%= render layout: "/public_activity/common", locals: { activity:, hide_owner: true, icon: "cheque", color: "info" } do %>
      <%= hcb_code.check_deposit.created_by.name %> deposited a <%= render_money hcb_code.amount %>
      check on <%= link_to activity.trackable.event.name, activity.trackable.event %>
    <% end %>
  <% end %>

  <%# stripe card %>
  <% if (hcb_code.stripe_card? || hcb_code.stripe_force_capture?) && hcb_code.stripe_card.present? %>
    <%= render layout: "/public_activity/common", locals: { activity: } do %>
      spent <%= render_money hcb_code.amount %> at <%= hcb_code.stripe_merchant %>
      on <%= link_to activity.trackable.event.name, activity.trackable.event %>
    <% end %>
  <% end %>

  <%# disbursement %>
  <% if hcb_code.disbursement? && hcb_code.disbursement.present? %>
    <% source = hcb_code.disbursement.source_event %>
    <% destination = hcb_code.disbursement.destination_event %>
    <% if activity.event_id == source.id %>
      <%= render layout: "/public_activity/common", locals: { activity:, hide_owner: true, icon: "payment", color: "info" } do %>
        <%= source.name %> transferred <%= render_money hcb_code.amount_cents_by_event(destination) %> to <%= destination.name %>
      <% end %>
    <% else %>
      <%= render layout: "/public_activity/common", locals: { activity:, hide_owner: true, icon: "payment", color: "info" } do %>
        <%= destination.name %> received <%= render_money hcb_code.amount_cents_by_event(destination) %> from <%= source.name %>
      <% end %>
    <% end %>
  <% end %>

  <%# fee revenue %>
  <% if hcb_code.fee_revenue? && hcb_code.fee_revenue.present? %>
    <%= render layout: "/public_activity/common", locals: { activity:, hide_owner: true, icon: "plus-fill", color: "primary" } do %>
      HCB received <%= render_money hcb_code.amount %> in fee revenue
    <% end %>
  <% end %>

  <%# the activity log currently doesn't support any other HCB code types. %>

<% end %>
