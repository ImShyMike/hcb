<div class="organizer-position-invite card flex flex-col overflow-visible mb2">
  <div class="organizer-position-invite__main-info flex">
    <div class="flex g2" style="flex-grow: 1">
      <div class="flex justify-between">
        <div class="relative">
          <%= inline_icon("admin-badge", size: 48, class: "avatar-container__admin-bolt") if position.user.admin? %>
          <%= avatar_for position.user, 64 %>
        </div>
      </div>
      <div class="flex flex-col justify-center">
        <p class="h2 bold m0"><%= position.user.name %></p>
        <% if Flipper.enabled?(:user_permissions_2024_03_09, @event) && organizer_signed_in? %>
          <div class="flex g0 line-height-0 items-center">
            <p class="h4 medium info"><%= position.role.capitalize %></p>
            <% if policy(position).change_position_role? %>
              <div data-controller="menu" data-menu-placement-value="bottom-start" data-action="click->menu#toggle click@document->menu#close keydown@document->menu#keydown" data-menu-target="toggle">
                <%= inline_icon "down-caret", class: "info menu__toggle" %>
                <div data-menu-target="content" class="menu__content menu__content--2 menu__content--compact">
                  <% OrganizerPosition.roles.keys.each do |role| %>
                    <%= link_to change_position_role_organizer_path(id: position.id, to: role), data: { turbo_method: "post", turbo_frame: "_top" }, aria: { current: position.role == role } do %>
                      <%= role.humanize %><%= " ✔" if position.role == role %>
                    <% end %>
                  <% end %>
                  <div class="menu__divider"></div>
                  <%= link_to "What do these mean?", roles_path %>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
    <% if organizer_signed_in? %>
      <div class="flex g1 h-fit-content">
        <% if admin_signed_in? %>
          <div class="tooltipped tooltipped--s" aria-label="Edit user's settings">
            <%= pop_icon_to "controls", edit_user_path(position.user.slug), data: { turbo_frame: "_top" }, class: "admin-tools rounded-full overflow-hidden" %>
          </div>
          <% unless position.user == current_user %>
            <div class="tooltipped tooltipped--s" aria-label="Impersonate user">
              <%= pop_icon_to "spy", impersonate_user_path(id: position.user.id, return_to: request.url), data: { turbo_method: "post", turbo_frame: "_top" }, class: "admin-tools rounded-full overflow-hidden" %>
            </div>
          <% end %>
        <% end %>
        <% if position.organizer_position_deletion_requests.under_review.exists? %>
          <div class="tooltipped tooltipped--w" aria-label="Pending removal request">
            <%= pop_icon_to "clock", "#", class: "muted", disabled: true %>
          </div>
        <% else %>
          <%= pop_icon_to "member-remove",
                          new_event_organizer_remove_path(organizer_id: position.user.slug),
                          class: "error tooltipped tooltipped--s",
                          'aria-label': "Remove user from organization",
                          data: { turbo_frame: "_top" },
                          disabled: !organizer_signed_in?(as: :manager) %>
        <% end %>
      </div>
    <% end %>
  </div>
  <% if organizer_signed_in? %>
    <div class="organizer-position-invite__contact-block g1 flex muted overflow-auto">
      <p class="m0">
        <%= copy_to_clipboard(position.user.email, class: "inline-flex items-center g1 line-height-0") do %>
          <%= inline_icon("email", size: 20) %>
          <%= position.user.email %>
        <% end %>
      </p>
      <% if admin_signed_in? %>
        <p class="organizer-position-invite__contact-block-separator h3 m0 line-height-1">•</p>
        <p class="warning m0">
          <%= copy_to_clipboard(position.user.phone_number, class: "inline-flex items-center g1 line-height-0") do %>
            <%= inline_icon("message-simple", size: 20) %>
            <%= position.user.phone_number %>
          <% end %>
        </p>
      <% end %>
    </div>
  <% end %>
  <div class="muted flex justify-between align-bottom relative w-100 h6 mt1">
    <p class="m0">Invited <%= relative_timestamp(position.organizer_position_invite.created_at) %> by <%= position.organizer_position_invite.sender.name %></p>
    <% user_mention position.organizer_position_invite.sender %>
    <% if admin_signed_in? %>
      <div class="absolute right-0 bottom-0 line-height-0 tooltipped tooltipped--w" aria-label="<%= (position.signee? ? "Contract signee" : "No contract signature") + ". Click to toggle." %>">
        <%= link_to toggle_signee_status_organizer_path(position.id), data: { turbo_method: "post", turbo_frame: "_top", turbo_confirm: "Are you sure you want to toggle #{position.user.name}'s contract signee status?" } do %>
          <div class="warning">
            <% if position.signee? %>
              <%= inline_icon("docs-positive", size: 24) %>
            <% else %>
              <%= inline_icon("docs-negative", size: 24) %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
