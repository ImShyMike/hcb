<% title "Reimbursements for #{@event.name}" %>
<% page_md %>
<%= render "events/nav", selected: :reimbursements %>

<h1 class="heading">
  Reimbursements
  <%= link_to "#", class: "btn", data: { behavior: "modal_trigger", modal: "create" } do %>
    <%= inline_icon "docs" %>
    New
  <% end %>
</h1>

<section data-behavior="modal" role="dialog" id="create" class="modal modal--scroll bg-snow">
  <%= form_with(model: Reimbursement::Report, class: "mb3", style: "max-width: 600px;", method: :post) do |form| %>
    <%= modal_header "Open a Report" %>
    <%= form.label :report_name, "Report Name", class: "bold" %>
    <%= form.text_field :report_name, placeholder: "Chicago Trip Expenses", required: true %>
    <%= form.label :maximum_amount, "Maximum Reimbursable Value (Optional)", class: "mt2 bold" %>
    <div class="field">
      <div class="flex items-center">
        <span class="bold muted" style="width: 1rem;">$</span>
        <%= form.number_field :maximum_amount, placeholder: "500.00", step: 0.01, min: 0.01, required: false, disabled: @event.demo_mode?, data: {controller: "truncate-decimal", action: "truncate-decimal#truncate" } %>
      </div>
    </div>
    <%= form.label :user_id, "Associated User", class: "mt1 bold" %>
    <%= form.select :user_email, @event.users.map { |u| [ u.name, u.email] } + [["Non-Organizer", "other"]], id: "reimbursement_report_user"  %>
    <%= form.text_field :other_email, class: 'hidden', placeholder: "Enter this individual's email", class: "mt1", data: {"behavior": "reimbursement_report_email_input"}, required: false %>
    <%= form.hidden_field :event_id, value: @event.id %>
    <%= form.submit "Submit", class: "mt2" %>
  <% end %>
</section>

<% if @reports.blank? %>
  <%= blankslate "No reports found!" %>
<% else %>
  <article class="table-container">
    <table>
      <thead>
      <tr>
        <th>Report</th>
        <th>Created at</th>
        <th>Submitted by</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
        <% @reports.each do |report| %>
          <tr>
            <td>
              <%= report.name %>
            </td>
            <td>
              <%= report.created_at.strftime("%m-%d-%Y") %>
            </td>
            <td>
               <%= user_mention report.user %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </article>
<% end %>
