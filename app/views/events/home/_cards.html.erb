<% @show_card_popovers = Flipper.enabled?(:hcb_code_popovers_2023_06_16, current_user) %>

<% if @cards.length > 0 %>
<div class="card card--breakdown shadow-none p-0 flex-1 flex flex-col">
  <h3 class="m-0 p-4 pb-0 mb-1">My cards</h3>
  <% @cards.each do |card| %>
    <div class="flex items-center gap-3 py-2 px-4 cursor-pointer <%= @show_card_popovers ? "hover:bg-gray-50 active:bg-gray-100 transition-colors dark:hover:bg-neutral-700 dark:active:bg-neutral-600" : "" %>"  <% if @show_card_popovers && !show_mock_data? %> data-behavior="modal_trigger" data-modal="card_popover_<%= card.id %>" <% end %> data-turbo-frame="_top" href="<%= !show_mock_data? ? (local_assigns[:href] || stripe_card_path(card)) : "javascript:;" %>">
      <div class="h-7 w-10 rounded-sm <%= "stripe-card--white" if card.personalization_design&.white? %>
      <%= "stripe-card--black" if card.personalization_design&.black? %>" style="background-size: 12px; background-image: <%= GeoPattern.generate(card.id).to_data_uri  unless card.platinum? || card.personalization_design.present? %>"></div>
      Your
      <%= card.stripe_brand %> Card <%= "(#{card.hidden_card_number_with_last_four})"  %>
    </div>
    <% if @show_card_popovers %>
      <section class="modal modal--scroll modal--popover modal--popover--sm bg-snow" data-behavior="modal" role="dialog" id="card_popover_<%= card.id %>">
        <%= modal_header(card.initially_activated ? "Card #{card.last_four}" : "Inactive card", external_link: card.url) %>
        <%= async_frame_to card.popover_url, as: :span, lazy: true do %>
          Loading...
        <% end %>
      </section>
    <% end %>
  <% end %>
  <%= link_to event_cards_overview_path(event_id: @event.slug), class: "flex items-center mt-auto px-4 pb-2" do %>
    View all cards
    <%= inline_icon "enter" %>
  <% end %>
</div>

<% else %>
  <div class="card card--breakdown shadow-none p-0 text-center flex-1 flex flex-col items-center justify-center" style="height: <%= [(@cards.length + 1.5) * 45, 320].max %>px">
    <h3 class="m-0 p-4 pb-0 max-w-xs">
      No cards yet
    </h3>
    <p class="m-0 p-4 pt-2 pb-0 mb-1 muted max-w-xs">
      Cards you've ordered will appear here
    </p>
    <%= link_to event_cards_new_path(event_id: @event.slug), class: "btn mt-2", data: { behavior: "modal_trigger", modal: "order_card" } do %>
      <%= inline_icon "card-add" %>
      Order a card
    <% end %>
  </div>
<% end %>
