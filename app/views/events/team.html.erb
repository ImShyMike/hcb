<% title "Team overview" %>
<% page_sm %>
<%= render "nav", selected: :team %>

<h1 class="heading flex items-center">
  Team
  <%= badge_for @all_positions.size, class: "bg-muted" %>

  <% if organizer_signed_in? %>
    <a href="mailto:<%= @all_positions.map(&:user).map(&:email).join(",") %>" class="btn btn--icon bg-info">
      <%= inline_icon "email" %>
      Email everyone
    </a>
  <% end %>
</h1>

<% if @all_positions.any? %>
  <%= turbo_frame_tag "team_position" do %>
    <%= render partial: "organization_position_invite", collection: @positions, as: :position %>
    <%= paginate @positions %>
  <% end %>
<% else %>
  <%= blankslate "No others on your team yet" %>
<% end %>

<h2 class="mt3">Invite a team member</h2>
<% if organizer_signed_in? %>
  <%= render "form_invite", invite: OrganizerPositionInviteService::Create.new(event: @event).model %>
<% else %>
  <p>Disabled in transparency mode</p>
<% end %>

<% if @pending.any? %>
  <h2 class="flex items-center mt3 mb2">
    Pending invitations
    <%= badge_for @pending.size, class: "bg-muted" %>
  </h2>

  <div class="flex flex-column" style="gap: 0.5rem">
    <% @pending.order(created_at: :desc).each do |invite| %>
      <div class="organizer-position-invite card grid pt1 pb1">
        <div class="flex flex-col items-center">
          <div class="organizer-position-invite__info flex flex-auto justify-start items-center" style="gap: 1rem">
            <p class="line-height-3 m0">
              <strong><%= organizer_signed_in? ? invite.user.email : "Sign in to view" %></strong>
            </p>

            <% if admin_signed_in? %>
              <div class="line-height-0 tooltipped tooltipped--e" aria-label="<%= (invite.signee? ? "Contract signee" : "No contract signature") + ". Click to toggle." %>">
                <%= link_to toggle_signee_status_organizer_position_invite_path(invite.id), data: { turbo_method: "post", turbo_frame: "_top", turbo_confirm: "Are you sure you want to toggle #{invite.user.name}'s contract signee status?" } do %>
                  <div class="warning">
                    <% if invite.signee? %>
                      <%= inline_icon("docs-positive", size: 24) %>
                    <% else %>
                      <%= inline_icon("docs-negative", size: 24) %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>

          <div class="organizer-position-invite__cancel flex justify-end align-items-center">
            <% if organizer_signed_in? %>
              <%= pop_icon_to "view-close",
                organizer_position_invite_cancel_path(invite.id),
                size: 24,
                method: :post,
                class: "error tooltipped tooltipped--w",
                'aria-label': "Cancel this invitation" %>
            <% end %>
          </div>

        <p class="organizer-position-invite__date justify-end muted h6 m0">Invited <%= relative_timestamp(invite.created_at) %> by <%= invite.sender.full_name %></p>
      </div>
    <% end %>
  </div>
<% end %>
