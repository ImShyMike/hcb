<% title "Team overview" %>
<% page_sm %>
<%= render "nav", selected: :team %>

<h1 class="heading">
  <span class="flex items-center">
    Team
    <%= badge_for @all_positions.size, class: "bg-muted" %>
  </span>

  <% if organizer_signed_in? %>
    <%= mail_to @all_positions.map { |op| op.user.email_address_with_name }.join(","), class: "btn btn--icon bg-info" do %>
      <%= inline_icon "email" %>
      Email everyone
    <% end %>

    <%= link_to new_event_organizer_position_invite_path(event_id: @event.slug), class: "btn bg-success", data: { behavior: "modal_trigger", modal: "invite_member" }, disabled: !organizer_signed_in?(as: :manager) do %>
      <%= inline_icon "member-add" %>
      Invite
    <% end %>
  <% end %>
</h1>

<% if organizer_signed_in? %>
  <section class="modal modal--scroll bg-snow" data-behavior="modal" role="dialog" id="invite_member">
    <%= modal_header "Invite a team member" %>
    <%= render "form_invite", invite: OrganizerPositionInviteService::Create.new(event: @event).model %>
  </section>
<% end %>

<% if @all_positions.any? %>
  <%= turbo_frame_tag "team_position" do %>
    <%= render partial: "organization_position_invite", collection: @positions, as: :position %>
    <%= paginate @positions %>
  <% end %>
<% else %>
  <%= blankslate "No others on your team yet" %>
<% end %>

<% if @pending.any? %>
  <h2 class="flex items-center mt3 mb2">
    Pending invitations
    <%= badge_for @pending.size, class: "bg-muted" %>
  </h2>

  <div class="flex flex-col" style="gap: 0.5rem">
    <%= render partial: "organization_position_invite_pending", collection: @pending, as: :invite %>
  </div>
<% end %>
