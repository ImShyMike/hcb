<%= form_with model: user, data: { turbo: false } do |form| %>
  <fieldset>
    <legend class="heading h3 pb2">How would you like to reimbursed?</legend>
    <div class="field field--options">
      <%= form.radio_button :payout_method_type, "User::PayoutMethod::AchTransfer" %>
      <%= form.label :payout_method_type, value: "User::PayoutMethod::AchTransfer" do %>
        <%= inline_icon "payment-transfer", size: 28 %>
        <strong>ACH Transfer</strong>
        <small>(2-3 biz. days)</small>
      <% end %>
      <%= form.radio_button :payout_method_type, "User::PayoutMethod::Check" %>
      <%= form.label :payout_method_type, value: "User::PayoutMethod::Check" do %>
        <%= inline_icon "email", size: 28 %>
        <strong>Mailed Check</strong>
        <small>(10-12 biz. days)</small>
      <% end %>
    </div>
  </fieldset>
  <section data-behavior="check_payout_method_inputs" class="<%= "display-none-not-important" unless user.payout_method.instance_of?(User::PayoutMethod::Check) %>">
    <%= form.fields_for :payout_method, user.payout_method.instance_of?(User::PayoutMethod::Check) ? user.payout_method : User::PayoutMethod::Check.new do |form| %>
      <div class="field">
        <%= form.label :address_line1, "Street address" %>
        <%= form.text_field :address_line1, placeholder: StripeCardholder::DEFAULT_BILLING_ADDRESS[:line1] %>
      </div>

      <div class="field">
        <%= form.text_field :address_line2, placeholder: "(Building / Apartment / Room)" %>
      </div>

      <div class="flex">
        <div class="field flex-auto mr1">
          <%= form.label :address_city, "City" %>
          <%= form.text_field :address_city, placeholder: StripeCardholder::DEFAULT_BILLING_ADDRESS[:city] %>
        </div>
        <div class="field flex-auto ml1">
          <%= form.label :address_state, "State / Province" %>
          <%= form.select :address_state, ISO3166::Country.new("US").subdivisions.values.map { |s| [s.translations["en"], s.code] }, { prompt: "Select a state" } %>
        </div>
      </div>

      <div class="field">
        <%= form.label :postal_code %>
        <%= form.text_field :address_postal_code, placeholder: StripeCardholder::DEFAULT_BILLING_ADDRESS[:postal_code] %>
      </div>

      <div class="actions inline-block mt1">
        <%= form.submit "Save" %>
      </div>
    <% end %>
  </section>
  <section data-behavior="ach_transfer_payout_method_inputs" class="<%= "display-none-not-important" unless user.payout_method.instance_of?(User::PayoutMethod::AchTransfer) %>">
    <%= form.fields_for :payout_method, user.payout_method.instance_of?(User::PayoutMethod::AchTransfer) ? user.payout_method : User::PayoutMethod::AchTransfer.new do |form| %>
      <div class="field">
        <%= form.label :routing_number, "Bank routing number" %>
        <%= form.text_field :routing_number, placeholder: "123456789", class: "fs-mask" %>
      </div>

      <div class="field">
        <%= form.label :account_number, "Bank account number" %>
        <%= form.text_field :account_number, placeholder: "0913338883", class: "fs-mask" %>
      </div>

      <div class="actions inline-block mt1">
        <%= form.submit "Save" %>
      </div>
    <% end %>
  </section>
  <% if defined?(report) %>
    <%= form.hidden_field :report_id, value: report.id %>
  <% end %>
<% end %>
