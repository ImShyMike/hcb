<%= render "users/mobile_nav", selected: local_assigns[:selected] %>
<% content_for(:header) do %>
  <%= render partial: "logo" %>
<% end %>

<% content_for(:nav) do %>
  <nav class="dock font-medium mt-4">
    <% users_mobile_nav(selected: local_assigns[:selected]).each do |item| %>
      <div>
        <%= dock_item item[:name],
          item[:path],
          tooltip: item[:tooltip],
          icon: item[:icon],
          selected: item[:selected] %>
      </div>
    <% end %>
    <div>
      <%= render "users/settings_dropdown", local_assigns: %>
    </div>
    <% if @first_visit %>
      <div class="pwa__prompt" style="position: relative">
        <div class="pwa__prompt__hide" onclick="hidePWAPrompt()">
          <%= inline_icon "private-fill", size: 24, class: "pwa__prompt__icon" %>
        </div>
        <b>Looking for a mobile app?</b>
        <br>
        Click <%= inline_icon "share", size: 18, class: "pwa__prompt__icon" %>
        and then <%= inline_icon "plus-box", size: 18, class: "pwa__prompt__icon" %>
        <i>Add to Home Screen</i>.
      </div>
    <% end %>
  </nav>

  <% if (current_user.events.not_demo_mode.funded.exists? || current_user.card_grants.any? || current_user.reimbursement_reports.any?) && Flipper.enabled?(:bank_wrapped, current_user) %>
    <div id="bank-wrapped-dialog" style="display: none;">
      <article role="alertdialog" class="flash flex items-center mt2 mb1 mx-auto shrink-none cursor-pointer" onclick="document.getElementById('bank-wrapped-link').click()" style="background: url('https://cloud-7sn7fc3g0-hack-club-bot.vercel.app/0frame_1__16_.svg'); background-size: 300px; background-position: 0px -10px; background-repeat: repeat; color: white;">
        <span class="flex-auto flex justify-between items-center">
          <span>Check out your <a href="/wrapped" target="_blank" class="primary nowrap" style="color: white;" id="bank-wrapped-link"><strong>HCB Wrapped</strong></a> for 2024!</span>
        </span>
        <svg onclick="(localStorage.setItem('hide_hcb_wrapped_2024', 'true'), document.getElementById('bank-wrapped-dialog').remove())" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414" aria-label="view-close" clip-rule="evenodd" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" class="pointer" style=""><g><path d="M11.121,9.707c-0.39,-0.391 -1.024,-0.391 -1.414,0c-0.391,0.39 -0.391,1.024 0,1.414l4.95,4.95l-4.95,4.95c-0.391,0.39 -0.391,1.023 0,1.414c0.39,0.39 1.024,0.39 1.414,0l4.95,-4.95l4.95,4.95c0.39,0.39 1.023,0.39 1.414,0c0.39,-0.391 0.39,-1.024 0,-1.414l-4.95,-4.95l4.95,-4.95c0.39,-0.39 0.39,-1.024 0,-1.414c-0.391,-0.391 -1.024,-0.391 -1.414,0l-4.95,4.95l-4.95,-4.95Z"></path></g></svg>
      </article>
    </div>

    <script>
      if (localStorage.getItem('hide_hcb_wrapped_2024') !== 'true') {
        document.getElementById('bank-wrapped-dialog').style.display = 'block';
      }
    </script>
  <% end %>

  <% if Flipper.enabled?(:recently_on_hcb_2024_05_23, current_user) && @activities %>
    <h4 class="w-100 mb0 text-left mt3 border-bottom pb1 activity">
      <span class="flex items-center w-100">
          <span class="flex-grow">Recent activity</span>
          <% if admin_signed_in? %>
            <%= link_to toggle_admin_activities_path, data: { turbo_frame: "activities-1", turbo: true, turbo_method: :POST } do %>
              <% admin_tool("ml2 h6 badge bg-muted", style: "padding: 0.25rem 0.625rem; border-radius: 9999px;") do %>
                ðŸ‘¤ <%= User.currently_online.count %>
              <% end %>
            <% end %>
          <% end %>
      </span>
    </h4>

    <%= error_boundary fallback_text: "No recent activities available." do %>
      <%= render partial: "my/activities" if Flipper.enabled?(:recently_on_hcb_2024_05_23, current_user) && @activities %>
    <% end %>
  <% end %>

<% end %>
