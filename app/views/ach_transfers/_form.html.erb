<%= form_with(model: @ach_transfer, local: true, url: event_ach_transfers_path(@event)) do |form| %>
  <%= form_errors(@ach_transfer, 'ACH transfer') %>
  <%= form_errors(@ach_recipient, 'Recipient') %>

  <% if @event.ach_recipients.any? %>
    <div class="field">
      <%= form.label :ach_recipient, 'Recipient' %>
      <%= form.select :ach_recipient,
        options_for_select(!organizer_signed_in? ? [] : @event.ach_recipients.map { |b|
          ["#{b.first_name} #{b.last_name}", b.id, { 'data-json': b.to_json } ]
        }),
        include_blank: 'New Recipient...' %>
    </div>
  <% end %>

  <%= form.fields_for :ach_recipient_attributes do |form| %>
    <h2>Recipient details</h2>

    <p data-behavior="ach_recipient_update_warning" style="display: none;" class="flex items-center info line-height-3">
      <%= inline_icon 'important', size: 32, class: 'mr1' %>
      You're currently updating a previous recipient
    </p>

    <div class="field">
      <%= form.label :first_name %>
      <%= form.text_field :first_name, placeholder: 'Max', required: true %>
    </div>

    <div class="field">
      <%= form.label :last_name %>
      <%= form.text_field :last_name, placeholder: 'Kern', required: true %>
    </div>

    <div class="field">
      <%= form.label :phone %>
      <%= form.text_field :phone, placeholder: '1234567890', required: true %>
    </div>

  <% end %>

  <div class="field">
    <%= form.label :payment_for, "What are you paying for with this deposit?" %>
    <%= form.text_field :payment_for, placeholder: 'Shipment of potions', required: true %>
    <span class="muted">This is to help Hack Club Bank keep record of our transactions. Bank team will see this.</span>
  </div>

  <h2>Bank Information</h2>

  <% if @event.ach_recipients.any? and false %>
    <div class="field">
      <%= form.label :ach_account, 'Bank account' %>
      <%= form.select :ach_account,
        options_for_select(!organizer_signed_in? ? [] : @event.ach_accounts.map { |b|
          [b.bank_name ]
        }),
        include_blank: 'New bank account...' %>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :bank_name %>
    <%= form.text_field :bank_name, placeholder: 'Name of the bank', required: true %>
  </div>

  <div class="field">
    <%= form.label :routing_number %>
    <%= form.text_field :routing_number, placeholder: '123456789', required: true %>
  </div>

  <div class="field">
    <%= form.label :account_number %>
    <%= form.text_field :account_number, placeholder: '0913338883', required: true %>
  </div>

  <%= form.label :amount, 'Amount' %>
  <div class="field">
    <div class="flex items-center">
      <span class="bold muted" style="width: 1rem;">$</span>
      <%= form.number_field :amount, 
      value: (@ach_transfer.amount.nil? ? nil : (@ach_transfer.amount.to_f / 100)),
      placeholder: '500.00', step: 0.01, min: 0.01, required: true %>
    </div>
  </div>
  <div class="actions tooltipped tooltipped--n inline-block" aria-label="ACH transfers can't be cancelled">
    <%= form.submit 'Transfer money now', class: 'btn bg-warning', disabled: !organizer_signed_in? %>
  </div>
<% end %>
