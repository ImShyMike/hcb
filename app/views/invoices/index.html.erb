<% title "Invoices for #{@event.name}" %>
<% page_md %>
<%= render 'events/nav' %>

<h1 class="heading">
  <span class="flex items-center">
    Invoices
    <%= badge_for @invoices.size, class: 'bg-muted' %>
  </span>
  <%= link_to 'Send an invoice',
    new_event_invoice_path(event_id: @event.slug),
    class: 'btn bg-success' %>
</h1>

<% if @invoices.any? %>
  <div class="filterbar flex flex-wrap items-center width-100">
    <input
      type="search"
      data-behavior="filterbar_search"
      placeholder="Searchâ€¦"
      aria-label="Filter invoices"
      class="flex-auto md-mr2"
      style="width: auto; max-width: none;">
    <div data-behavior="filterbar" role="tablist" class="filterbar__filters flex mt1 lg-mt0">
      <%= filterbar_item 'All', :exists, true %>
      <%= filterbar_item 'Paid', :paid %>
      <%= filterbar_item 'Unpaid', :unpaid %>
      <%= filterbar_item 'Upcoming', :upcoming %>
      <%= filterbar_item 'Overdue', :overdue %>
    </div>
  </div>

  <ul class="grid grid--spacious">
    <% @invoices.each do |i| %>
      <%= link_to i, data: { behavior: 'filterbar_row', filter: i.filter_data.to_json } do %>
        <%= creator_bar i %>
        <li class="card">
          <div class="flex">
            <strong class="flex-auto h3 line-height-3 mb1">
              <%= i.sponsor.name %>
            </strong>
            <span class="block h1 black line-height-1 <%= i.state %>"><%= render_money_short i.item_amount %></span>
          </div>
          <span class="ml0 badge bg-<%= i.state %>">
            <%= i.state_text %>
          </span>
        </li>
      <% end %>
    <% end %>
  </ul>
  <%= filterbar_blankslate 'No invoices match this filter' %>
<% else %>
  <%= blankslate 'Send invoices to sponsors to collect payment' %>
<% end %>
