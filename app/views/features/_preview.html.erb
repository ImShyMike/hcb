<% disabled = !policy(local_assigns[:event] || current_user).update? %>

<% if !defined?(unlisted) || !defined?(@shown_private_feature_previews) || @shown_private_feature_previews&.include?(local_assigns[:id]) || Flipper.enabled?(local_assigns[:feature_flag], local_assigns[:event] || current_user) %>
  <div class="card mt2 mb2 border" id="<%= local_assigns[:id] %>">
    <div class="card__banner card__banner--top border-bottom flex justify-between items-center <%= local_assigns[:classes]&.any? ? local_assigns[:classes].join(" ") : "feature-generic" %>">
      <h3 class="h3 my0 color-black"><%= local_assigns[:name] %></h3>
      <% if local_assigns[:fully_shipped] || Flipper.enabled?(local_assigns[:feature_flag]) %>
        <%# Feature is enabled for all users, don't include a choice %>
        <div class="actions tooltipped tooltipped--w inline-block mt1" aria-label="This feature is now generally available!">
          <span class="btn bg-success btn-small disabled">Shipped!</span>
        </div>
      <% elsif Flipper.enabled?(local_assigns[:feature_flag], local_assigns[:event] || current_user) %>
        <%= link_to "Disable", disable_feature_path(feature: local_assigns[:feature_flag], event_id: local_assigns[:event]&.id), method: :post, class: "btn btn-small bg-error", data: { turbo_confirm: local_assigns[:disable_warning], turbo_method: "post" }, disabled: %>
      <% else %>
        <%= link_to "Enable", enable_feature_path(feature: local_assigns[:feature_flag], event_id: local_assigns[:event]&.id), method: :post, class: "btn bg-accent btn-small", disabled: %>
      <% end %>
    </div>
    <p class="m-0">
      <%= sanitize(local_assigns[:description]) %>
    </p>
    <% if local_assigns[:footer].present? %>
      <section class="card__banner card__darker secondary border-top mt-4 -mb-4">
        <p class="m-0">
          <%= sanitize(local_assigns[:footer], attributes: %w(href data-turbo-action)) %>
        </p>
      </section>
    <% end %>
  </div>
<% end %>
