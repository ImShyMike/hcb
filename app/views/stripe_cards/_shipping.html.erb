<div class="card p0 flex flex-column">
  <div class="">
    <h3 class="border-none m0 p2">
      Card for
      <% if @event %>
        <%= user_mention stripe_card.user %>
      <% else %>
        <%= link_to stripe_card.event.name, stripe_card.event %>
      <% end %>
    </h3>
    <% if stripe_card.shipping_has_tracking? %>
      <section class="card__banner card__darker details-horiz border-top border-bottom m0">
        <p>
          <strong>Carrier</strong>
          <%= stripe_card.stripe_obj&.shipping&.carrier&.capitalize %>
        </p>
        <p>
          <strong>ETA</strong>
          <%= format_date Time.at(stripe_card.stripe_obj&.shipping&.eta).to_date %>
        </p>
        <p>
          <strong>Tracking #</strong>
          <%= stripe_card.stripe_obj&.shipping&.tracking_number %>
        </p>
      </section>

      <footer class="flex flex-wrap items-center p2 relative">
        <%= image_tag "https://logo.clearbit.com/#{stripe_card.stripe_obj&.shipping&.carrier}.com", width: 64, height: 64, style: "height: auto; object-fit: contain;", class: "rounded bg-white mr2" %>
        <%= link_to stripe_card.stripe_obj&.shipping&.tracking_url, class: "btn" do %>
          <%= inline_icon "external" %>
          Track shipment
        <% end %>
      </footer>
    <% else %>
      <section class="pl2 muted pb2 mb1">
        <% eta = stripe_card.stripe_obj&.shipping&.eta %>
        <% if eta %>
          Estimated to arrive <%= format_date Time.at(stripe_card.stripe_obj&.shipping&.eta).to_date %>
        <% else %>
          No estimated arrival date
        <% end %>
      </section>
    <% end %>
  </div>

  <% map_url = card_shipping_map_url(stripe_card) %>
  <%= image_tag map_url, style: "width: 100%; height: auto; object-fit: cover;", width: 256, height: 128 if map_url %>
</div>
