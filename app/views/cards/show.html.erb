<% page_md %>
<%= render 'events/nav' %>

<div class="emburse-cards__card">
  <p class="emburse-cards__card__number">
    <span>XXXX-XXXX-XXXX-</span><strong><%= @card.last_four %></strong>
  </p>
  <p class="emburse-cards__card__name"><%= @card.full_name %></p>
</div>
<article class="card max-width-2 mx-auto mt3">
  <section class="details mb3">
    <h2 class="mt0 mb0 heading">
    <span class="flex-auto">Card for <%= @card.full_name %></span>
    <%= card_mention @card %>
    </h2>

    <p>
      <strong>Ordered by</strong>
      <%= user_mention @card.user %>
    </p>

    <p>
      <strong>Email address</strong>
      <%= @card.user.email %>
    </p>

    <div>
      <strong>Card number</strong>
      XXXX-XXXX-XXXX-<%= @card.last_four %>
      <div class="right tooltipped tooltipped--w" aria-label="Full number hidden to protect security">
        <%= inline_icon 'private', size: 32, class: 'smoke' %>
      </div>
    </div>

    <% admin_tools do %>
      <strong>Emburse ID</strong>
      <%= link_to @card.emburse_id, @card.emburse_path %>
    <% end %>
  </section>

  <% admin_tools do %>
    <%= link_to 'Edit', edit_card_path(@card), class: 'btn bg-info' %>
  <% end %>
</article>

<% if @emburse_transactions.any? %>
  <h2 class="mt3">
    Transactions made on this card
  </h2>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Name</th>
        <th>Cost</th>
        <th>Details</th>
      </tr>
    </thead>
    <tbody>
    <% @emburse_transactions.each do |t| %>
      <tr>
        <td><%= t.transaction_time.to_date %></td>
        <td>
          <span class="tooltipped tooltipped--n" aria-label="<%= t.state.capitalize %>">
          <%= status_badge t.status_badge_type %>
          </span>
          <%= t.merchant_name %>
        </td>
        <td><%= render_money -t.amount %></td>
        <td>
          <a href="<%= t.emburse_path %>" target="_blank">More</a>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
<% end %>
