# frozen_string_literal: true

module OneTimeJobs
  class FixOrganizerPositionInviteNilUsersJob < ApplicationJob
    def perform
      broken_ids = [19, 37, 40, 49, 99, 106, 108, 148, 158, 164, 166, 183, 184, 187, 188, 189, 261, 275, 281, 283, 287, 291, 300, 302, 313, 314, 316, 317, 319, 320, 328, 332, 340, 344, 345, 362, 366, 377, 380, 382, 394, 409, 430, 432, 433, 450, 451, 471, 503, 509, 544, 604, 616, 625, 628, 629, 636, 639, 640, 641, 642, 643, 648, 649, 692, 735, 737, 738, 753, 754, 755, 756, 757, 760, 765, 768, 774, 775, 778, 781, 792, 793, 802, 805, 882, 899, 900, 901, 902, 907, 910, 912, 930, 938, 946, 947, 950, 962, 972, 974, 988, 989, 1043, 1077, 1081, 1090, 1092, 1096, 1099, 1106, 1111, 1112, 1113, 1114, 1115, 1121, 1122, 1140, 1145, 1156, 1170, 1171, 1172, 1177, 1183, 1211, 1215, 1231, 1266, 1270, 1271, 1281, 1282, 1283, 1314, 1334, 1335, 1336, 1342, 1347, 1355, 1358, 1359, 1360, 1364, 1367, 1369, 1370, 1375, 1378, 1382, 1393, 1394, 1395, 1401, 1405, 1406, 1408, 1412, 1415, 1416, 1425, 1432, 1434, 1435, 1437, 1456, 1474, 1484, 1495, 1498, 1519, 1520, 1521, 1529, 1531, 1532, 1548, 1549, 1562, 1602, 1604, 1605, 1636, 1639, 1645, 1651, 1655, 1657, 1660, 1671, 1690, 1696, 1705, 1706, 1719, 1741, 1752, 1755, 1757, 1766, 1775, 1807, 1808, 1824, 1825, 1826, 1832, 1839, 1844, 1854, 1874, 1877, 1937, 1941, 1946, 1959, 1973, 2005, 2006, 2018, 2020, 2028, 2029, 2039, 2045, 2052, 2055, 2061, 2062, 2064, 2065, 2076, 2077, 2083, 2090, 2096, 2133, 2134, 2137, 2140, 2152, 2153, 2157, 2159, 2160, 2162, 2165, 2174, 2175, 2179, 2184, 2210, 2213, 2215, 2216, 2217, 2221, 2231, 2234, 2248, 2249, 2250, 2254, 2256, 2274, 2275, 2281, 2284, 2288, 2302, 2315, 2319, 2320, 2321, 2322, 2324, 2332, 2338, 2344, 2352, 2353, 2358, 2361, 2378, 2386, 2390, 2391, 2398, 2400, 2416, 2431, 2436, 2476, 2500, 2501, 2515, 2521, 2526, 2532, 2544, 2546, 2547, 2549, 2550, 2553, 2587, 2594, 2596, 2598, 2609, 2612, 2618, 2627, 2629, 2639, 2647, 2686, 2687, 2692, 2695, 2696, 2698, 2706, 2708, 2709, 2723, 2731, 2738, 2745, 2754, 2755, 2768, 2771, 2778, 2788, 2789, 2796, 2805, 2812, 2818, 2871, 2875, 2927, 2943, 2949, 2964, 2965, 2976, 2977, 2985, 2990, 3004, 3026, 3033, 3043, 3044, 3050, 3055, 3057, 3061, 3064, 3065, 3073, 3081, 3125, 3128, 3138, 3156, 3160, 3163, 3166, 3169, 3175, 3176, 3177, 3181, 3186, 3189, 3195, 3204, 3206, 3209, 3212, 3213, 3214, 3219, 3221, 3227, 3229, 3233, 3244, 3246, 3247, 3248, 3254, 3255, 3256, 3257, 3258, 3261, 3262, 3297, 3300, 3302, 3314, 3316, 3317, 3323, 3340, 3347, 3357, 3358, 3371, 3372, 3373, 3374, 3375, 3376, 3377, 3378, 3379, 3380, 3381, 3382, 3383, 3395, 3398, 3400, 3401, 3402, 3405, 3410, 3411, 3419, 3423, 3425, 3430, 3432, 3436, 3444, 3445, 3446, 3447, 3448, 3459, 3460, 3461, 3466, 3467, 3474, 3475, 3476, 3486, 3491, 3492, 3494, 3495, 3496, 3498, 3500, 3505, 3560, 3561, 3562, 3565, 3568, 3569, 3570, 3576, 3584, 3585, 3586, 3588, 3589, 3590, 3592, 3630, 3632, 3636, 3637, 3638, 3651, 3660, 3666, 3671, 3672, 3674, 3678, 3683, 3684, 3686, 3688, 3690, 3691, 3693, 3695, 3696, 3699, 3706, 3719, 3721, 3722, 3723, 3724, 3726, 3728, 3733, 3739, 3740, 3743, 3746]
      fail if broken_ids.count != 512

      # create or find users that aren't associated (basically what OrganizerPositionInviteService::Create does now)
      OrganizerPositionInvite.where(id: broken_ids).each do |opi|
        if opi.user.email != "cjdenio44@gmail.com"
          fail "unexpected organizer_position_invite"
        end

        user = User.find_or_create_by!(email: opi.email)
        opi.update(user: user)

        if opi.reload.user.email != opi.email
          fail "unexpected organizer_position_invite"
        end
      end
    end

  end
end
